var DOMManager,xPathAnalyzer,keyupFn,logger=function(a,b){chrome.tabs.getSelected(null,function(c){chrome.tabs.executeScript(null,{file:"js/min/logger.js"},function(){chrome.tabs.sendMessage(c.id,JSON.stringify({type:a,message:b}))})})};DOMManager=function(){var a=document.getElementById("xpath-input"),b=document.getElementById("xpath-output"),c=document.querySelector("#result-box .last-query"),d=document.querySelector("#result-box .last-query-result"),e=document.getElementById("error-alert"),f=document.querySelector("#error-alert .trace");return{handleError:function(c,d){f.innerText=d,c&&(a.className="hidden",document.getElementById("xpath").removeEventListener("keyup",keyupFn,!1)),b.className="hidden",e.className="",logger("error",d)},showResult:function(a,f){c.innerText=xPathAnalyzer.lastQuery,d.innerHTML=a?"> "+f:"Check the <b>Console</b> tab of your <em>Chrome Dev Tools</em>.",e.className="hidden",b.className=""}}}(),xPathAnalyzer=function(){return{xml:null,lastQuery:null,test:function(a){var b,c={},d=this;try{d.lastQuery=a,c=d.xml.evaluate(a,d.xml,null,XPathResult.ANY_TYPE,null)}catch(e){DOMManager.handleError(!1,e.message)}switch(c.resultType){case 1:DOMManager.showResult(!0,c.numberValue);break;case 2:DOMManager.showResult(!0,c.stringValue);break;case 3:DOMManager.showResult(!0,c.booleanValue);break;case 4:b=d.lastQuery.split("/"),"text()"==b[b.length-1]||0==b[b.length-1].indexOf("@")?(c=d.xml.evaluate("count("+a+")",d.xml,null,XPathResult.NUMBER_TYPE,null),c.numberValue>1?0==b[b.length-1].indexOf("@")?(b.pop(),d.getAllAttributes(b.join("/"))):(b.pop(),d.getAllTextContent(b.join("/"))):(c=d.xml.evaluate("string("+a+")",d.xml,null,XPathResult.STRING_TYPE,null),DOMManager.showResult(!0,c.stringValue))):d.getAllElement()}},getAllElement:function(){var a,b=this,c=new XMLSerializer,d=b.xml.evaluate(b.lastQuery,b.xml,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);logger("info","Result(s) for "+b.lastQuery+": ");try{for(a=d.iterateNext(),a||logger("warn","Not found.");a;)logger("xml",c.serializeToString(a)),a=d.iterateNext();DOMManager.showResult(!1)}catch(e){DOMManager.handleError(!1,e)}},getAllAttributes:function(a){var b,c,d,e={},f=[],g=this;"//@"==g.lastQuery.substr(0,3)&&(a="/"+a+"*"),d=g.xml.evaluate(a,g.xml,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),c=g.lastQuery.split("/@"),c=c[c.length-1],logger("info","Result(s) for "+g.lastQuery+": ");try{for(b=d.iterateNext();b;){if("*"==c){e={},b=b.parentNode?b:b.children[0];for(var h in b.attributes)b.attributes.hasOwnProperty(h)&&b.hasAttribute(b.attributes[h].name)&&(e[b.attributes[h].name]=b.attributes[h].value);f.push(e)}else e={},b=b.parentNode?b:b.children[0],b.hasAttribute(c)&&(e[c]=b.getAttribute(c),f.push(e));b=d.iterateNext()}logger("table",f),DOMManager.showResult(!1)}catch(i){DOMManager.handleError(!1,i)}},getAllTextContent:function(a){var b,c=1,d=this,e=d.xml.evaluate(a,d.xml,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);logger("info","Result(s) for "+d.lastQuery+": ");try{for(b=e.iterateNext();b;)logger("info",c+" - "+b.textContent),b=e.iterateNext(),c++;DOMManager.showResult(!1)}catch(f){DOMManager.handleError(!1,f)}}}}(),window.onload=function(){chrome.tabs.executeScript(null,{file:"js/min/getPageContent.js"},function(){chrome.extension.lastError&&DOMManager.handleError(!0,chrome.extension.lastError.message)}),chrome.extension.onMessage.addListener(function(a){var b;if("getSource"==a.action)try{if("undefined"==typeof a.source)throw"This page does not contain an XML document.";b=new DOMParser,xPathAnalyzer.xml=b.parseFromString(a.source,"text/xml")}catch(c){DOMManager.handleError(!0,c)}}),keyupFn=function(a){13==a.which&&xPathAnalyzer.test(this.value)},document.getElementById("xpath").addEventListener("keyup",keyupFn,!1)};